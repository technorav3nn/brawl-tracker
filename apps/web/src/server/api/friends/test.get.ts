import { listProfiles, type Friend } from "@brawltracker/supercell-id-api";
import { chunk, wait } from "$lib/utils/common";

const scids = [
	"00-e7538add-70a9-40eb-96f1-5bcfdb2fdedf",
	"01-0ec7f7da-c51c-4e85-99f6-6b781abd66b2",
	"01-4515b652-bff6-471c-a6ee-aae411783b19",
	"02-14496889-bc10-43c7-95f4-b28dcc7a7d0e",
	"02-a0343a81-06d1-48e8-97e1-e83b883fdfd5",
	"02-bc157ef2-0f1a-45e6-ba5b-bf46b654e228",
	"02-dc2beb3a-9fc0-48b7-9cf1-8e6f92e97c5d",
	"03-19105121-f215-46ea-9719-96f607ac84e9",
	"03-8ed68d96-69e8-4f35-8491-ccaab59e490d",
	"03-8f0e61ea-e2a3-4717-91d2-e5a1ab50b34a",
	"03-aaa986dd-9c39-4e7a-8adf-5f5e05cfacd1",
	"04-70831a0c-b908-4e1d-870e-a2ecab0348de",
	"05-72611496-7d2a-43d3-b335-1239a0530657",
	"05-d433af4c-2b7c-4cdd-8396-ef9e7c256bf0",
	"06-8e1316cc-0a67-4c05-9faf-1b5196795200",
	"06-926d55e1-7566-44cd-97f7-c05484d987cd",
	"07-56260b34-8abe-4f83-8586-9b07fea18db5",
	"08-0795bbee-7c6f-4e60-9681-2799af838114",
	"08-813c4221-4527-4d43-9f38-17679233b421",
	"09-1ac75532-bc9a-4e0d-832c-4516aee2ea7c",
	"09-bb9a03d0-dbb9-437f-a506-3d354eefbdc7",
	"10-37f3d545-2974-4d1e-af6b-33a78202fde8",
	"10-e50bb093-4a4e-46ff-9382-f687f58ad480",
	"10-fc3fbd33-da3b-4845-a76b-bbf45093024c",
	"11-137a5142-fa03-4aa3-bc90-f75b9cfc5312",
	"11-14006d6d-83b1-4f77-83d9-cab0819eac14",
	"11-9f81ad66-27b1-44c1-9052-9b2a69e9e523",
	"11-d3ea29fd-0501-4cf4-8087-84fb988cb296",
	"11-ecd57a50-d9fb-47e6-87e7-cec3150b33c1",
	"13-890fbf86-6891-4b28-a27e-3600bd10b61f",
	"13-d1984a80-837f-4943-9623-ea5cb6386b7b",
	"16-00ce37f9-c58c-4f35-ac7a-a4ab338ed4ee",
	"16-406d7e2a-8423-4eea-a622-9604ec25a623",
	"16-74ed97f7-dbb6-44c4-9112-b9a5c111d145",
	"16-92ed3262-f036-4964-8f8e-2c848af10cd8",
	"17-1d9dfafc-4b52-4799-9074-9e774cbd2d6a",
	"17-8d600cf5-63e3-41b0-adb4-13a6705f2656",
	"17-a20916e0-4d26-4468-8084-4399813177b6",
	"17-c0ee4d9d-f2ee-4c50-8d16-14af17097587",
	"18-8cdd2489-c731-44b8-8f83-263713a66874",
	"18-d0f96a7f-5a97-411c-8e88-76a5364b6ab7",
	"19-60c6c78b-764f-445d-bf7a-3759a439a8fe",
	"19-63e57a04-1d4c-4163-9d23-aaa7279f64f8",
	"19-8fda12af-5c06-4cfc-ab03-e489738b563c",
	"19-c2dcd297-33ba-435e-9f9f-0559cb8b225f",
	"21-af04cbce-6664-420f-a0ad-055ccaf4346a",
	"22-c25c8610-d46b-4b0e-bd37-83fb3d6e8431",
	"23-dbed3071-1464-4607-a0d8-bc791ffb71c8",
	"24-727a2741-0415-4afe-9d1a-38e3f190c2b0",
	"24-e914c109-cc51-47fe-ba1a-9d5e1d858175",
	"25-9967249a-e240-4f62-8d1f-b955847adfee",
	"26-07c32d66-c997-43b7-bebe-9316d9ffd8d2",
	"26-a651a808-c40c-49ec-b978-70224cfea1f2",
	"27-264dc804-1376-40f9-b08d-313bc55376d5",
	"27-274b9999-b9e5-4e5b-a161-aa706576fe03",
	"30-612efdd0-9848-4da0-86f8-ab6a580b444d",
	"32-b4e1de0c-f032-4001-84e3-6cb82e36abbb",
	"33-4b72813b-160c-49b8-8a8f-2f783d6338ea",
	"33-df4299f6-6abf-4cd8-88b9-ac8317d303d3",
	"34-0390095e-34ea-4d0d-a57a-15c5db558908",
	"36-d179f1d9-240d-42ef-8f33-e89cff169f23",
	"36-f4b6b5b9-8a47-434c-942f-b18b72fb8b62",
	"37-ef035da3-c392-4ff2-9a9e-dfb6b764f5e9",
	"38-ec600d14-4645-45fd-b2a1-584b94d635cc",
	"39-14dd4536-d723-4806-8116-502f7c5d5102",
	"39-6fca3179-a2b5-440b-a8d5-d00f61c05703",
	"40-80da9b60-1bc8-4fe2-a769-619efab9bed5",
	"40-9565e9cb-d1e3-4168-b28a-ffb3b01a3336",
	"40-df22ebf7-c585-4446-88be-3bf71644ad65",
	"41-cb7e9a05-f7f5-4c9f-bc67-b0390fcfbd0b",
	"41-cc364805-fef8-4ec6-bef9-7d414e555ab5",
	"42-a5d35389-bb95-4960-a49c-e35693afdac3",
	"43-87be277d-f84f-4d75-86d6-361bd57ff08e",
	"43-f2751254-a403-42bf-8614-af519dbc9f59",
	"44-463b46c5-2b59-4d7e-b251-85a2e07775ed",
	"44-e6c382b3-5160-45be-bfc0-678aac103490",
	"45-a6c9ba27-5ed8-40c3-9e53-20d73a36d0f8",
	"45-cca02349-64e8-44b1-b6fe-21775fea66f7",
	"46-91adb109-b69e-4d58-8e16-1e2954fef009",
	"47-310b13f8-ffb7-4b3d-959d-a433059b0feb",
	"47-5346a65c-8078-432d-85d7-da4ca50cd5f1",
	"48-6ea4d645-cb42-4e79-b4da-6ac6a0c90a74",
	"48-8c735805-f60c-4afc-bad5-b2ec410d0ed9",
	"49-c0d91518-c56b-42eb-b930-65f823d69b4d",
	"50-7cc480b5-5c63-40ab-8778-07effc9845e1",
	"51-14bc6000-04ee-48d6-bb7a-2f5b2bb7a4a2",
	"51-a37fa991-48eb-44e1-a3d9-bf4fa9597348",
	"53-599665f6-df9c-4426-80b7-b532d37b38fa",
	"54-4b3cda3a-5c96-4b35-9826-f07f57c7c1f4",
	"54-908ab59c-ec10-4d19-8d4f-2beb1b20fe38",
	"55-0378cee5-2228-41d5-8997-bfe83c579485",
	"56-5d27f139-b46e-43ee-a24d-2085082b9d07",
	"56-778bb662-c486-49bf-9895-14a3b3988474",
	"57-29493106-a079-4a0b-99ec-b39da393b5fe",
	"57-3470c2ed-e9ee-46ac-bbf9-0176ebaa8a21",
	"57-b95376ee-fb4c-480c-b463-d348904715ff",
	"57-c0288bc1-88df-40be-aa9f-2185e8586de7",
	"59-0b0b54eb-31d9-40fb-a866-19a4071beb1c",
	"59-20138aef-6c65-47fc-a6c6-5c87c1d9c113",
	"59-f92846fa-5c46-4909-8166-7a392fac9958",
	"60-335b4bbd-415b-4d0c-89e5-6f2daa290b45",
	"60-c1325553-c5b0-4731-8d58-26662adfa299",
	"61-2a386a97-1ce8-422e-8b15-56adc581d874",
	"61-501c5f43-1df3-4e13-9c92-4b79af9afe48",
	"61-b7d3308f-3ddd-417a-a52f-8133bbf9b0f2",
	"62-a0f97f09-23aa-4bc4-ae9e-de02589c2a4a",
	"62-f4e351c6-01db-4758-87a5-58e07d5ce1cf",
	"63-b1c26297-622a-4b8b-8f5c-31dca9af6d15",
	"64-894c78b1-a45c-442f-9cf5-12d9fa8e9a5c",
	"65-53911e24-9f54-4b05-afb8-8a30de97e4e4",
	"65-88a30029-da0a-4d03-a508-1a164d36f808",
	"65-c06cbdaf-49b2-422d-a681-e2829dbf192a",
	"66-04c71f7a-728b-439f-b5dc-6f10759e509f",
	"67-4bd8d6b4-1c8e-480e-b648-30c3f4a8f9d6",
	"67-7fe177cb-6096-407d-9d24-d036137984bd",
	"69-2d609e48-3e92-4a1e-8dc0-b2a95963431c",
	"69-494b8022-b2b0-4268-a4ae-9f179c7ac27a",
	"69-b8007aa6-c920-4f51-8202-8b697bd24868",
	"70-53d546aa-9db4-4190-8d28-c55dcb78a8d4",
	"71-5b80af38-1bc1-425e-b072-7fbee7d853a0",
	"72-e5a56610-a00e-4d22-bd58-3d3f28569329",
	"73-065471e1-69c2-41b3-a075-81e172daba74",
	"73-1d6780ab-f1ae-4e74-b70e-8e31a27d4b38",
	"73-333e2257-0100-4670-b02e-1a2786f1f46c",
	"73-cd6bae1b-b47f-4c9c-b7b5-16a12c212f1b",
	"74-e17f4cb3-dfc7-42e4-ad0a-21622bab40df",
	"75-bd4bc8ff-29b6-444e-b123-2f05223b4c77",
	"76-3462bc8c-7ff3-44cd-8c22-cf031d0f8d19",
	"76-aa770872-2360-4f4d-9fb4-b22f75ac6bc7",
	"77-f5db0ca9-32c9-42d2-8675-da416233ad40",
	"78-dfd72aac-e75e-4d57-8df5-a6e51352468f",
	"79-4c644690-d88e-43e3-8f1f-4b57e0985394",
	"83-90c239dd-e51a-44eb-956b-8911a87746e4",
	"84-734c568d-bfc2-4887-b002-2d9fef668788",
	"88-2d49eaa7-b24b-4243-9e68-e8e898f8795f",
	"89-1c2a8308-4700-40cf-a6bb-5d43d805ccd5",
	"89-3a14b91e-6b69-4475-a831-dd0d4a20b176",
	"89-800074c8-2fed-48b9-98a6-ce3aae45d2f5",
	"90-2310e3a2-c0b1-414e-841e-da4726656a5c",
	"90-586cf10d-b334-4abd-b374-bfd4c183062d",
	"90-ae591e73-c461-4ae0-9fa0-43bb665748f1",
	"91-5d1e5008-9fcf-4e86-ac38-669de082458a",
	"91-b14e1f04-448f-458f-937e-5792c8e7f78b",
	"93-1f164ad4-2139-430e-b40d-fa23a0bfb5e0",
	"94-31e527e7-dd90-48d0-b0ad-c929fde07ccf",
	"94-7f815c87-4944-47c8-9c2b-de405102fa8a",
	"94-b87a7876-b3fc-44ee-8c8d-57d4c3438d5e",
	"96-d3f288b6-a067-490e-8522-f1a8fad48ca0",
	"97-634debaf-389d-40ab-9564-cd32eb0ad007",
	"98-66a8ff9e-bf06-4aa2-a6d9-7bd823467980",
	"99-765e1b9b-5108-42f1-a083-4735df00a085",
];

export default defineEventHandler(async (event) => {
	const { scidAccountToken } = useRuntimeConfig(event);

	const sessionToken = await getCachedScidSessionToken(event, scidAccountToken);

	const chunks = chunk(scids, 50);

	const results = await Promise.all(
		chunks.map(async (chunk, index) => {
			if (index !== 0) await wait(1000);
			const result = await listProfiles(sessionToken!.token, chunk, "scids");
			if (!result.ok) throw new Error((result as any)?.message);
			return (result.data as any).profiles as Friend[];
		})
	);

	return results.flat();
});
